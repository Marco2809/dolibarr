<?php

header("Access-Control-Allow-Origin: *");
/*
echo ini_get('display_errors');

if (!ini_get('display_errors')) {
    ini_set('display_errors', '1');
}

echo ini_get('display_errors');
*/
$host = "localhost";
// username dell'utente in connessione
$user = "root";
// password dell'utente
$password = "servicetech14";
// nome del database
$db = "dolibarr";
$db1 = "fd_ticket";

$connessione = new mysqli($host, $user, $password, $db);
$connessione1 = new mysqli($host, $user, $password, $db1);


$matricola = array(
  '172437333001034001796447',
'173102233001034007069026',
'181072233001034007229195',
'181422233001034007272112',
'181422233001034007272339',
'182462233001034007381655',
'182582233001034007400137',
'182922233001034007455401',
'190112233001034007801463',
'190122233001034007803564',
'190132233001034007807829',
'190142233001034007808637',
'190177333001034003821729',
'190187333001034003822360',
'190187333001034003822686',
'190187333001034003822894',
'191242233001034008222963',
'191272233001034008237199',
'191272233001034008239052',
'191737333001034004960884',
'191777333001034010013936',
'191787333001034010018211',
'191787333001034010020948',
'191797333001034010032230',
'191797333001034010032246',
'191797333001034010032250',
'191797333001034010032312',
'191797333001034010032344',
'191797333001034010032508',
'191797333001034010032533',
'191797333001034010032652',
'191797333001034010032657',
'191797333001034010032664',
'191797333001034010032921',
'191797333001034010033084',
'191797333001034010033089',
'191797333001034010033132',
'191797333001034010033173',
'191797333001034010033190',
'191797333001034010033201',
'191797333001034010033213',
'191797333001034010033228',
'191797333001034010033241',
'191797333001034010033249',
'191797333001034010033311',
'191797333001034010033314',
'191797333001034010033322',
'191797333001034010033336',
'191797333001034010033342',
'191797333001034010033355',
'192077333001034010406176',
'192157333001034010513428',
'192157333001034010513438',
'192157333001034010513724',
'192157333001034010513743',
'192157333001034010513846',
'192157333001034010513930',
'192157333001034010513947',
'192197333001034010580194',
'192207333001034010589460',
'192207333001034010590714',
'192207333001034010590932',
'192207333001034010591350',
'192207333001034010591392',
'192207333001034010591408',
'192207333001034010591415',
'192207333001034010591416',
'192207333001034010591433',
'192207333001034010591439',
'192207333001034010591447',
'192207333001034010591459',
'192207333001034010591473',
'192207333001034010591489',
'192207333001034010591513',
'192207333001034010591527',
'192207333001034010591566',
'192207333001034010591567',
'192207333001034010591574',
'192207333001034010591678',
'192207333001034010591812',
'192207333001034010592005',
'192207333001034010592236',
'192307333001034010719202',
'192327333001034010725501',
'192327333001034010725715',
'192327333001034010725722',
'192777333001034011390404',
'192787333001034011394097',
'192787333001034011394419',
'192787333001034011394560',
'192787333001034011396041',
'192787333001034011396494',
'192787333001034011411026',
'192807333001034011434098',
'192807333001034011435150',
'192807333001034011435163',
'192807333001034011435208',
'192807333001034011435217',
'192807333001034011435222',
'192807333001034011435251',
'192807333001034011435255',
'192807333001034011435346',
'192807333001034011435509',
'192807333001034011435513',
'192807333001034011435525',
'192807333001034011435534',
'192807333001034011435606',
'192807333001034011435630',
'192807333001034011435638',
'192807333001034011435676',
'192807333001034011435697',
'192807333001034011435768',
'192807333001034011435846',
'192807333001034011436293',
'192817333001034011454069',
'HDPAXD210P',
'51859471',
'5c185548',
'5c186524',
'5c188814',
'5c189930',
'5c444270',
'5c444811',
'5c536401',
'5c536451',
'5c536529',
'5c637428',
'5c637430',
'5c637432',
'5c637433',
'5c637434',
'5c637440',
'5c637441',
'5c637442',
'5c638029',
'5c638597',
'5c638599',
'5c638602',
'5c638606',
'5c638728',
'5c638730',
'5c638731',
'5c638735',
'5c638739',
'5c638741',
'5c638744',
'5c638745',
'5c639174',
'5c639175',
'5c639179',
'5c639245',
'5c809859',
'5c809872',
'5c837806',
'5c837857',
'5c837858',
'5c837862',
'5c837864',
'5c837867',
'5c837872',
'5c837873',
'5c837874',
'5c837875',
'5c837876',
'5c886737',
'5c886738',
'5c886739',
'5c886740',
'5c886741',
'5c886742',
'5c886743',
'5c886744',
'5c886745',
'5c886746',
'5c886747',
'5c886748',
'5c886749',
'5c886750',
'5c886751',
'5c886752',
'5c886753',
'5c886754',
'5c886755',
'5c886756',
'5c886897',
'5c886899',
'5c886900',
'5c886901',
'5c886904',
'5c886906',
'5c886908',
'5c886910',
'5c886911',
'5c886913',
'5c886915',
'5c886916'
);

//print_r($matricola);

foreach($matricola as $m)
{


  $sql = "SELECT a.matricola, e.label from llx_asset as a INNER JOIN llx_entrepot as e ON a.id_magazzino = e.rowid WHERE matricola LIKE('%".$m."%') ";
  //echo $sql.'<br>';
  $result=$connessione->query($sql);
  while ($obj = mysqli_fetch_object($result))
  {

    if($obj->matricola!="") echo "MATRICOLA: ".$obj->matricola . " trovata nel magazzino " .$obj->label;
    if($obj->label=='COOPERSYSTEM'){
      $sql_t ="SELECT ref_num, zz_desc_op_eff, affected_resource_zz_wam_string2 FROM ost_ticket__cdata WHERE zz_desc_op_eff LIKE '%".trim($obj->matricola)."%' OR affected_resource_zz_wam_string2 LIKE '%".trim($obj->matricola)."%'";
      //echo $sql_t."<br>";
      $result_t=$connessione1->query($sql_t);
      $obj_t = mysqli_fetch_object($result_t);
      if($obj_t->ref_num!="") echo " nel ticket " .$obj_t->ref_num;
    }
    echo '.<br>';

  }
  if(mysqli_num_rows($result)==0){
    echo "<b>MATRICOLA: ".$m . " non trovata in nessun magazzino.</b><br>";
  }
}




?>
